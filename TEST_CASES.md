# ThingsBoard Config Mate 测试用例

> 版本：v1.4.6  
> 更新日期：2026-01-16

---

## 一、环境兼容性测试

### TC-ENV-001：Ubuntu 22.04 LTS 环境测试

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-ENV-001 |
| **测试模块** | 环境兼容性 |
| **优先级** | P0 (必测) |
| **前置条件** | Ubuntu 22.04 LTS 系统，已安装 Docker 20.10+、Node.js 18+ |

**测试步骤：**

1. 在 Ubuntu 22.04 系统上执行 `node tb-config-src.js`
2. 观察终端输出，确认无报错
3. 打开浏览器访问 `http://localhost:3300`
4. 确认页面正常加载

**预期结果：**

- [ ] 工具启动成功，终端输出监听端口信息
- [ ] 浏览器能正常访问配置界面
- [ ] 无 Node.js 版本兼容性错误

**实际结果：**

| 测试人 | 测试日期 | 结果 | 备注 |
|--------|----------|------|------|
| | | ⬜ | |

---

### TC-ENV-002：CentOS 7.x 环境测试

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-ENV-002 |
| **测试模块** | 环境兼容性 |
| **优先级** | P0 (必测) |
| **前置条件** | CentOS 7.x 系统，已安装 Docker 20.10+、Node.js 18+ |

**测试步骤：**

1. 在 CentOS 7.x 系统上执行 `node tb-config-src.js`
2. 观察终端输出，确认无报错
3. 打开浏览器访问 `http://localhost:3300`
4. 确认页面正常加载

**预期结果：**

- [ ] 工具启动成功
- [ ] 页面正常访问
- [ ] 文件读写权限正常

**实际结果：**

| 测试人 | 测试日期 | 结果 | 备注 |
|--------|----------|------|------|
| | | ⬜ | |

---

### TC-ENV-003：Chrome 浏览器兼容性测试

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-ENV-003 |
| **测试模块** | 浏览器兼容性 |
| **优先级** | P0 (必测) |
| **前置条件** | Chrome 最新稳定版，工具已启动 |

**测试步骤：**

1. 使用 Chrome 浏览器访问 `http://localhost:3300`
2. 检查页面布局是否正常渲染
3. 测试表单输入、下拉选择、按钮点击
4. 测试弹窗打开/关闭
5. 查看实时日志推送是否正常

**预期结果：**

- [ ] 页面布局无错位、无样式丢失
- [ ] 表单交互响应正常
- [ ] 弹窗动画流畅
- [ ] SSE 日志推送正常

**实际结果：**

| 测试人 | 测试日期 | 结果 | 备注 |
|--------|----------|------|------|
| | | ⬜ | |

---

### TC-ENV-004：Edge 浏览器兼容性测试

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-ENV-004 |
| **测试模块** | 浏览器兼容性 |
| **优先级** | P0 (必测) |
| **前置条件** | Edge 最新稳定版，工具已启动 |

**测试步骤：**

1. 使用 Edge 浏览器访问 `http://localhost:3300`
2. 检查页面布局是否正常渲染
3. 测试表单输入、下拉选择、按钮点击
4. 测试弹窗打开/关闭

**预期结果：**

- [ ] 页面布局无错位
- [ ] 表单交互响应正常
- [ ] 弹窗显示正常

**实际结果：**

| 测试人 | 测试日期 | 结果 | 备注 |
|--------|----------|------|------|
| | | ⬜ | |

---

### TC-ENV-005：Docker Compose v2 兼容性测试

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-ENV-005 |
| **测试模块** | Docker 环境 |
| **优先级** | P0 (必测) |
| **前置条件** | 已安装 Docker Compose v2.x (使用 `docker compose` 命令) |

**测试步骤：**

1. 确认系统使用 `docker compose` 命令 (v2)
2. 在工具界面点击「重启服务」
3. 观察终端日志，确认调用的是 `docker compose` 而非 `docker-compose`

**预期结果：**

- [ ] 工具自动检测到 Docker Compose v2
- [ ] 服务重启命令使用 `docker compose up -d`
- [ ] 容器正常启动

**实际结果：**

| 测试人 | 测试日期 | 结果 | 备注 |
|--------|----------|------|------|
| | | ⬜ | |

---

### TC-ENV-006：Docker Compose v1 兼容性测试

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-ENV-006 |
| **测试模块** | Docker 环境 |
| **优先级** | P1 (推荐) |
| **前置条件** | 已安装 Docker Compose v1.x (使用 `docker-compose` 命令) |

**测试步骤：**

1. 确认系统使用 `docker-compose` 命令 (v1)
2. 在工具界面点击「重启服务」
3. 观察终端日志，确认调用的是 `docker-compose`

**预期结果：**

- [ ] 工具自动检测到 Docker Compose v1
- [ ] 服务重启命令使用 `docker-compose up -d`
- [ ] 容器正常启动

**实际结果：**

| 测试人 | 测试日期 | 结果 | 备注 |
|--------|----------|------|------|
| | | ⬜ | |

---

## 二、前置条件与初始化测试

### TC-INIT-001：Edge 模式自动识别

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-INIT-001 |
| **测试模块** | 模式检测 |
| **优先级** | P0 (必测) |
| **前置条件** | `conf/` 目录下存在 `tb-edge.yml` 文件 |

**测试步骤：**

1. 确保 `conf/tb-edge.yml` 存在
2. 删除或重命名 `conf/thingsboard.yml`（如存在）
3. 启动工具 `node tb-config-src.js`
4. 访问 `http://localhost:3300`
5. 查看页面标题或状态栏

**预期结果：**

- [ ] 工具自动识别为 Edge 模式
- [ ] 页面显示 Edge 相关配置组（如「Edge 连接配置」「离线恢复策略」）
- [ ] 不显示 Cloud 专属配置

**实际结果：**

| 测试人 | 测试日期 | 结果 | 备注 |
|--------|----------|------|------|
| | | ⬜ | |

---

### TC-INIT-002：Cloud 模式自动识别

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-INIT-002 |
| **测试模块** | 模式检测 |
| **优先级** | P0 (必测) |
| **前置条件** | `conf/` 目录下存在 `thingsboard.yml` 文件 |

**测试步骤：**

1. 确保 `conf/thingsboard.yml` 存在
2. 删除或重命名 `conf/tb-edge.yml`（如存在）
3. 启动工具 `node tb-config-src.js`
4. 访问 `http://localhost:3300`
5. 查看页面配置分组

**预期结果：**

- [ ] 工具自动识别为 Cloud 模式
- [ ] 页面不显示 Edge 专属配置组
- [ ] 显示 MQTT 端口等 Cloud 配置项

**实际结果：**

| 测试人 | 测试日期 | 结果 | 备注 |
|--------|----------|------|------|
| | | ⬜ | |

---

### TC-INIT-003：配置文件缺失阻断

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-INIT-003 |
| **测试模块** | 错误处理 |
| **优先级** | P0 (必测) |
| **前置条件** | `conf/` 目录下不存在 `tb-edge.yml` 和 `thingsboard.yml` |

**测试步骤：**

1. 删除或重命名 `conf/tb-edge.yml` 和 `conf/thingsboard.yml`
2. 启动工具 `node tb-config-src.js`
3. 访问 `http://localhost:3300`
4. 观察页面行为

**预期结果：**

- [ ] 页面显示阻断性错误弹窗
- [ ] 提示"未找到 ThingsBoard 配置文件"
- [ ] 无法进入正常配置界面

**实际结果：**

| 测试人 | 测试日期 | 结果 | 备注 |
|--------|----------|------|------|
| | | ⬜ | |

---

### TC-INIT-004：.env 自动生成

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-INIT-004 |
| **测试模块** | 自动初始化 |
| **优先级** | P0 (必测) |
| **前置条件** | `.env` 文件不存在，但 `conf/tb-edge.yml` 存在 |

**测试步骤：**

1. 确保 `.env` 文件不存在（删除或重命名）
2. 启动工具 `node tb-config-src.js`
3. 检查当前目录

**预期结果：**

- [ ] 工具自动创建 `.env` 文件
- [ ] `.env` 中包含从 YAML 提取的默认配置值
- [ ] 终端输出提示"已自动生成 .env"

**实际结果：**

| 测试人 | 测试日期 | 结果 | 备注 |
|--------|----------|------|------|
| | | ⬜ | |

---

### TC-INIT-005：.env 缺失配置自动补充

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-INIT-005 |
| **测试模块** | 自动初始化 |
| **优先级** | P1 (推荐) |
| **前置条件** | `.env` 存在但缺少部分配置项 |

**测试步骤：**

1. 创建一个只包含 `APPTYPE=EDGE` 的 `.env` 文件
2. 启动工具 `node tb-config-src.js`
3. 检查 `.env` 文件内容

**预期结果：**

- [ ] 工具自动补充缺失的配置项
- [ ] 原有配置项保持不变
- [ ] 新增的配置项使用默认值

**实际结果：**

| 测试人 | 测试日期 | 结果 | 备注 |
|--------|----------|------|------|
| | | ⬜ | |

---

### TC-INIT-006：安装向导显示与执行

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-INIT-006 |
| **测试模块** | 安装向导 |
| **优先级** | P0 (必测) |
| **前置条件** | `docker-compose-install.yml` 文件存在 |

**测试步骤：**

1. 确保 `docker-compose-install.yml` 存在
2. 启动工具并访问 `http://localhost:3300`
3. 查看页面是否显示「初始化安装」按钮
4. 点击「初始化安装」按钮
5. 在确认弹窗中点击「确认」
6. 观察安装进度

**预期结果：**

- [ ] 页面显示「初始化安装」按钮
- [ ] 点击后弹出确认对话框
- [ ] 确认后显示安装进度弹窗
- [ ] 实时显示安装日志
- [ ] 安装完成后显示成功提示

**实际结果：**

| 测试人 | 测试日期 | 结果 | 备注 |
|--------|----------|------|------|
| | | ⬜ | |

---

## 三、可视化配置管理测试

### TC-CFG-001：配置分组展示

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-CFG-001 |
| **测试模块** | 配置展示 |
| **优先级** | P0 (必测) |
| **前置条件** | Edge 模式，工具已启动 |

**测试步骤：**

1. 访问 `http://localhost:3300`
2. 查看配置分组列表
3. 验证各配置项是否归入正确的分组

**预期结果：**

- [ ] 显示「SQL 数据库」分组
- [ ] 显示「Edge 连接配置」分组
- [ ] 显示「离线恢复策略」分组
- [ ] 显示「缓存配置」分组
- [ ] 各配置项位于正确的分组中

**实际结果：**

| 测试人 | 测试日期 | 结果 | 备注 |
|--------|----------|------|------|
| | | ⬜ | |

---

### TC-CFG-002：条件依赖 - Kafka 配置显隐

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-CFG-002 |
| **测试模块** | 条件依赖 |
| **优先级** | P0 (必测) |
| **前置条件** | Edge 模式，工具已启动 |

**测试步骤：**

1. 找到「消息队列」分组中的「队列类型」配置
2. 将队列类型切换为 `kafka`
3. 观察「离线恢复策略」分组
4. 将队列类型切换回 `in-memory`
5. 再次观察「离线恢复策略」分组

**预期结果：**

- [ ] 选择 kafka 时，显示 Kafka 相关配置项（拉取条数等）
- [ ] 选择 in-memory 时，Kafka 配置项隐藏
- [ ] 切换时无页面错误

**实际结果：**

| 测试人 | 测试日期 | 结果 | 备注 |
|--------|----------|------|------|
| | | ⬜ | |

---

### TC-CFG-003：条件依赖 - Redis 配置显隐

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-CFG-003 |
| **测试模块** | 条件依赖 |
| **优先级** | P0 (必测) |
| **前置条件** | 工具已启动 |

**测试步骤：**

1. 找到「缓存配置」分组中的「缓存类型」配置
2. 将缓存类型切换为 `redis`
3. 观察是否显示 Redis 相关配置项
4. 将缓存类型切换回 `caffeine`
5. 再次观察

**预期结果：**

- [ ] 选择 redis 时，显示 Redis 主机、端口、密码等配置项
- [ ] 选择 caffeine 时，Redis 配置项隐藏
- [ ] 切换时配置正确保存

**实际结果：**

| 测试人 | 测试日期 | 结果 | 备注 |
|--------|----------|------|------|
| | | ⬜ | |

---

### TC-CFG-004：配置保存与持久化

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-CFG-004 |
| **测试模块** | 配置保存 |
| **优先级** | P0 (必测) |
| **前置条件** | 工具已启动，页面正常加载 |

**测试步骤：**

1. 修改任意配置项的值（如数据库密码）
2. 点击「保存配置」按钮
3. 刷新页面
4. 检查修改的配置项

**预期结果：**

- [ ] 点击保存后显示成功提示
- [ ] 刷新页面后，修改的值仍保留
- [ ] `.env` 文件中对应配置已更新
- [ ] `.env_history/` 目录生成备份文件

**实际结果：**

| 测试人 | 测试日期 | 结果 | 备注 |
|--------|----------|------|------|
| | | ⬜ | |

---

### TC-CFG-005：源码模式编辑

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-CFG-005 |
| **测试模块** | 源码模式 |
| **优先级** | P1 (推荐) |
| **前置条件** | 工具已启动 |

**测试步骤：**

1. 点击「源码模式」切换按钮
2. 在编辑器中直接修改 `.env` 内容
3. 点击「保存配置」按钮
4. 切换回「UI 模式」
5. 检查修改是否反映到 UI

**预期结果：**

- [ ] 源码模式显示 `.env` 原始内容
- [ ] 可直接编辑文本
- [ ] 保存后切换回 UI，修改正确显示
- [ ] 无语法错误导致的崩溃

**实际结果：**

| 测试人 | 测试日期 | 结果 | 备注 |
|--------|----------|------|------|
| | | ⬜ | |

---

## 四、容器生命周期管理测试

### TC-CTR-001：服务状态检测

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-CTR-001 |
| **测试模块** | 容器管理 |
| **优先级** | P0 (必测) |
| **前置条件** | Docker 已安装，工具已启动 |

**测试步骤：**

1. 确保 ThingsBoard 容器正在运行
2. 访问 `http://localhost:3300`
3. 观察页面顶部状态徽章
4. 手动停止容器 `docker compose down`
5. 刷新页面，再次观察状态徽章

**预期结果：**

- [ ] 容器运行时，状态显示绿色 "Running" + 脉冲动画
- [ ] 容器停止时，状态显示灰色 "Stopped"
- [ ] 状态检测自动刷新（轮询）

**实际结果：**

| 测试人 | 测试日期 | 结果 | 备注 |
|--------|----------|------|------|
| | | ⬜ | |

---

### TC-CTR-002：服务启动/停止/重启

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-CTR-002 |
| **测试模块** | 容器管理 |
| **优先级** | P0 (必测) |
| **前置条件** | Docker 已安装，工具已启动 |

**测试步骤：**

1. 服务运行时，点击「停止服务」按钮
2. 确认弹窗中点击「确认」
3. 等待服务停止，观察状态变化
4. 服务停止后，点击「启动服务」按钮
5. 等待服务启动，观察状态变化
6. 服务运行时，点击「重启服务」按钮

**预期结果：**

- [ ] 停止服务弹出确认框
- [ ] 确认后服务正确停止，状态变为 Stopped
- [ ] 启动服务后，状态变为 Running
- [ ] 重启服务后，配置变更生效

**实际结果：**

| 测试人 | 测试日期 | 结果 | 备注 |
|--------|----------|------|------|
| | | ⬜ | |

---

### TC-CTR-003：确认弹窗取消后重新打开

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-CTR-003 |
| **测试模块** | 弹窗交互 |
| **优先级** | P0 (必测) |
| **前置条件** | 工具已启动 |

**测试步骤：**

1. 点击「停止服务」按钮
2. 在确认弹窗中点击「取消」
3. 再次点击「停止服务」按钮
4. 观察弹窗是否正常弹出

**预期结果：**

- [ ] 取消后弹窗关闭
- [ ] 再次点击按钮，弹窗能正常弹出
- [ ] 「重启服务」「初始化安装」按钮同理

**实际结果：**

| 测试人 | 测试日期 | 结果 | 备注 |
|--------|----------|------|------|
| | | ⬜ | |

---

## 五、配置版本控制测试

### TC-VER-001：历史版本查看与回滚

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-VER-001 |
| **测试模块** | 版本控制 |
| **优先级** | P0 (必测) |
| **前置条件** | 已多次保存配置，存在历史备份 |

**测试步骤：**

1. 点击页面右上角「历史版本」按钮
2. 查看历史版本列表
3. 选择某个历史版本
4. 查看与当前版本的 Diff 对比
5. 点击「回滚」按钮
6. 刷新页面，检查配置是否恢复

**预期结果：**

- [ ] 历史版本弹窗正常打开
- [ ] 列表显示备份时间戳
- [ ] Diff 对比清晰显示差异（新增/删除/修改）
- [ ] 回滚后配置恢复为选中版本
- [ ] `.env` 文件内容与回滚版本一致

**实际结果：**

| 测试人 | 测试日期 | 结果 | 备注 |
|--------|----------|------|------|
| | | ⬜ | |

---

## 六、运行时环境检测测试

### TC-RTD-001：运行时差异检测

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-RTD-001 |
| **测试模块** | 运行时检测 |
| **优先级** | P0 (必测) |
| **前置条件** | 服务已运行，本地 `.env` 与容器配置存在差异 |

**测试步骤：**

1. 修改本地 `.env` 中某个配置项的值
2. 保存配置（但不重启服务）
3. 点击「运行环境检查」按钮
4. 观察对比结果

**预期结果：**

- [ ] 弹窗显示配置对比表格
- [ ] 修改过的配置项显示 Modified 标识（黄色警告）
- [ ] 一致的配置项显示 Match 标识（绿色）
- [ ] 提示"需要重启服务使配置生效"

**实际结果：**

| 测试人 | 测试日期 | 结果 | 备注 |
|--------|----------|------|------|
| | | ⬜ | |

---

## 七、实时日志测试

### TC-LOG-001：实时日志查看

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-LOG-001 |
| **测试模块** | 实时日志 |
| **优先级** | P1 (推荐) |
| **前置条件** | 服务已运行 |

**测试步骤：**

1. 点击「查看日志」按钮
2. 观察日志窗口
3. 测试「自动换行」开关
4. 点击「清空日志」按钮

**预期结果：**

- [ ] 日志窗口正常打开
- [ ] 实时显示容器日志（SSE 推送）
- [ ] 默认开启自动换行，长日志正确换行
- [ ] 关闭自动换行后，长日志可横向滚动
- [ ] 清空日志后，日志区域为空

**实际结果：**

| 测试人 | 测试日期 | 结果 | 备注 |
|--------|----------|------|------|
| | | ⬜ | |

---

## 八、Edge 模式专项测试

### TC-EDGE-001：Edge 连接配置

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-EDGE-001 |
| **测试模块** | Edge 专项 |
| **优先级** | P0 (必测) |
| **前置条件** | Edge 模式，工具已启动 |

**测试步骤：**

1. 找到「Edge 连接配置」分组
2. 填写 `CLOUD_ROUTING_KEY` (UUID)
3. 填写 `CLOUD_ROUTING_SECRET`
4. 填写 `CLOUD_RPC_HOST`
5. 点击「保存配置」
6. 检查 `.env` 文件

**预期结果：**

- [ ] 配置项正确保存到 `.env`
- [ ] 重启服务后，Edge 能使用新配置连接云端
- [ ] 密钥字段显示为密文

**实际结果：**

| 测试人 | 测试日期 | 结果 | 备注 |
|--------|----------|------|------|
| | | ⬜ | |

---

### TC-EDGE-002：Kafka 离线恢复策略配置

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-EDGE-002 |
| **测试模块** | Edge 专项 |
| **优先级** | P0 (必测) |
| **前置条件** | Edge 模式，队列类型为 Kafka |

**测试步骤：**

1. 将「消息队列」中的队列类型切换为 `kafka`
2. 找到「离线恢复策略」分组
3. 验证是否显示以下配置项：
   - TB_QUEUE_KAFKA_CLOUD_EVENT_MAX_POLL_RECORDS
   - TB_QUEUE_KAFKA_CLOUD_EVENT_TS_MAX_POLL_RECORDS
4. 修改拉取条数值并保存
5. 检查 `.env` 文件

**预期结果：**

- [ ] 队列类型为 Kafka 时，显示 Kafka 拉取条数配置
- [ ] 队列类型为 in-memory 时，配置项隐藏
- [ ] 修改后配置正确保存

**实际结果：**

| 测试人 | 测试日期 | 结果 | 备注 |
|--------|----------|------|------|
| | | ⬜ | |

---

## 九、Cloud 模式专项测试

### TC-CLOUD-001：Cloud 模式配置

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-CLOUD-001 |
| **测试模块** | Cloud 专项 |
| **优先级** | P0 (必测) |
| **前置条件** | Cloud 模式，工具已启动 |

**测试步骤：**

1. 确保工具识别为 Cloud 模式
2. 验证不显示 Edge 专属配置组
3. 找到「MQTT 传输」分组
4. 配置 `MQTT_BIND_PORT` 端口
5. 保存配置

**预期结果：**

- [ ] 不显示「Edge 连接配置」「离线恢复策略」「遥测分离」等分组
- [ ] 显示 MQTT 端口配置
- [ ] 配置正确保存到 `.env`

**实际结果：**

| 测试人 | 测试日期 | 结果 | 备注 |
|--------|----------|------|------|
| | | ⬜ | |

---

## 附录：测试结果汇总

| 测试模块 | 用例数 | 通过 | 失败 | 阻塞 |
|----------|--------|------|------|------|
| 环境兼容性 | 6 | - | - | - |
| 前置条件与初始化 | 6 | - | - | - |
| 可视化配置管理 | 5 | - | - | - |
| 容器生命周期管理 | 3 | - | - | - |
| 配置版本控制 | 1 | - | - | - |
| 运行时环境检测 | 1 | - | - | - |
| 实时日志 | 1 | - | - | - |
| Edge 模式专项 | 2 | - | - | - |
| Cloud 模式专项 | 1 | - | - | - |
| **总计** | **26** | - | - | - |

---

## 图例说明

| 符号 | 含义 |
|------|------|
| ⬜ | 待测试 |
| ✅ | 通过 |
| ❌ | 失败 |
| ⚠️ | 阻塞/跳过 |
