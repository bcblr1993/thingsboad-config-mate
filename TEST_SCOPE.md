# ThingsBoard Config Mate 测试范围

## 一、测试环境兼容性

### 1.1 操作系统兼容性

| 操作系统 | 版本 | 测试优先级 | 状态 |
|----------|------|------------|------|
| Ubuntu | 22.04 LTS | P0 (必测) | ⬜ |
| Ubuntu | 20.04 LTS | P1 (推荐) | ⬜ |
| CentOS | 7.x | P0 (必测) | ⬜ |
| Rocky Linux | 8.x / 9.x | P1 (推荐) | ⬜ |
| Debian | 11 / 12 | P2 (可选) | ⬜ |
| macOS | 14 (开发环境) | P2 (可选) | ⬜ |

**测试要点：**

- [ ] Node.js 运行环境正常 (v18+)
- [ ] Docker / Docker Compose 命令正常执行
- [ ] 文件读写权限正常 (.env, .env_history/)
- [ ] 端口监听正常 (默认 3300)

---

### 1.2 浏览器兼容性

| 浏览器 | 版本 | 测试优先级 | 状态 |
|--------|------|------------|------|
| Chrome | 最新稳定版 | P0 (必测) | ⬜ |
| Edge | 最新稳定版 | P0 (必测) | ⬜ |
| Firefox | 最新稳定版 | P1 (推荐) | ⬜ |
| Safari | 17+ | P2 (可选) | ⬜ |

**测试要点：**

- [ ] 页面布局渲染正常
- [ ] 表单交互功能正常（输入、下拉、切换）
- [ ] 弹窗显示/关闭正常
- [ ] 实时日志 SSE 推送正常
- [ ] 本地存储/缓存正常

---

### 1.3 Docker 环境

| 组件 | 版本要求 | 状态 |
|------|----------|------|
| Docker Engine | 20.10+ | ⬜ |
| Docker Compose | v2.x (推荐 `docker compose`) | ⬜ |
| Docker Compose | v1.x (兼容 `docker-compose`) | ⬜ |

**测试要点：**

- [ ] 自动检测 Docker Compose 版本并使用正确命令
- [ ] 容器启动/停止/重启命令正常执行
- [ ] 容器日志获取正常 (docker logs -f)
- [ ] 容器环境变量检测正常 (docker inspect)

---

## 二、前置条件与初始化

### 2.1 配置文件检测

| 测试用例 | 预期结果 | 状态 |
|----------|----------|------|
| 存在 `conf/thingsboard.yml` | 自动识别为 Cloud 模式 | ⬜ |
| 存在 `conf/tb-edge.yml` | 自动识别为 Edge 模式 | ⬜ |
| 两者都不存在 | 显示阻断性错误，提示配置文件缺失 | ⬜ |
| `docker-compose.yml` 不存在 | 显示阻断性错误，提示文件缺失 | ⬜ |
| `docker-compose.yml` 未配置 `env_file` | 显示阻断性错误，提示需添加 `env_file: [.env]` | ⬜ |

---

### 2.2 .env 自动初始化

| 测试用例 | 预期结果 | 状态 |
|----------|----------|------|
| `.env` 文件不存在 | 工具自动从 YAML 提取默认值并创建 `.env` | ⬜ |
| `.env` 存在但缺少部分配置 | 工具自动补充缺失的配置项 | ⬜ |
| `.env` 已完整 | 不做修改，直接加载 | ⬜ |

---

### 2.3 安装向导

| 测试用例 | 预期结果 | 状态 |
|----------|----------|------|
| 存在 `docker-compose-install.yml` | 页面显示「初始化安装」按钮 | ⬜ |
| 不存在安装脚本 | 不显示安装按钮 | ⬜ |
| 点击「初始化安装」 | 弹出确认对话框 | ⬜ |
| 确认安装 | 执行安装脚本，实时显示日志和进度 | ⬜ |
| 系统已初始化 | 提示"系统已初始化 (无需重复安装)" | ⬜ |

---

## 三、可视化配置管理

### 3.1 配置分组与展示

| 测试用例 | 预期结果 | 状态 |
|----------|----------|------|
| 加载 Edge 模式 | 显示 Edge 专属配置组（连接、状态检查、遥测分离等） | ⬜ |
| 加载 Cloud 模式 | 不显示 Edge 专属配置组，显示 MQTT 端口等 | ⬜ |
| 点击「全部展开」 | 所有配置组展开 | ⬜ |
| 点击「全部折叠」 | 所有配置组折叠 | ⬜ |
| 配置项分组正确 | 各配置项归入正确的分组（如数据库、缓存、队列等） | ⬜ |

---

### 3.2 条件依赖 (dependsOn)

| 测试用例 | 预期结果 | 状态 |
|----------|----------|------|
| 队列类型选 Kafka | Kafka 相关配置项（服务器地址、拉取条数等）显示 | ⬜ |
| 队列类型选 in-memory | Kafka 相关配置项隐藏 | ⬜ |
| 缓存类型选 Redis | Redis 配置项（主机、端口等）显示 | ⬜ |
| 缓存类型选 caffeine | Redis 配置项隐藏 | ⬜ |
| 启用遥测分离 | 遥测分离相关配置项显示 | ⬜ |
| 禁用遥测分离 | 遥测分离相关配置项隐藏 | ⬜ |
| 存储类型选 Cassandra | Cassandra 配置项显示 | ⬜ |

---

### 3.3 配置值编辑

| 测试用例 | 预期结果 | 状态 |
|----------|----------|------|
| 编辑文本类型配置 | 输入值正确保存到 `.env` | ⬜ |
| 编辑数字类型配置 | 仅允许输入数字，保存正确 | ⬜ |
| 编辑下拉选择配置 | 选项切换后保存正确 | ⬜ |
| 编辑密码类型配置 | 值正确保存，显示为密文 | ⬜ |
| 点击密码眼睛图标 | 切换明文/密文显示 | ⬜ |

---

### 3.4 源码模式

| 测试用例 | 预期结果 | 状态 |
|----------|----------|------|
| 切换到源码模式 | 显示 `.env` 原始内容，可直接编辑 | ⬜ |
| 源码模式保存 | 修改后保存，内容写入 `.env` 文件 | ⬜ |
| 切换回 UI 模式 | UI 正确反映源码模式的修改 | ⬜ |
| 未保存时切换模式 | 提示有未保存的修改 | ⬜ |

---

## 四、容器生命周期管理

### 4.1 服务状态检测

| 测试用例 | 预期结果 | 状态 |
|----------|----------|------|
| 服务正在运行 | 状态徽章显示绿色 Running，脉冲动画 | ⬜ |
| 服务已停止 | 状态徽章显示灰色 Stopped，无动画 | ⬜ |
| Docker 未安装 | 显示错误提示 | ⬜ |

---

### 4.2 服务控制

| 测试用例 | 预期结果 | 状态 |
|----------|----------|------|
| 点击「停止服务」 | 弹出确认框，确认后容器停止 | ⬜ |
| 点击「启动服务」 | 容器启动，状态变为 Running | ⬜ |
| 点击「重启服务」 | 容器重启，应用最新 `.env` 配置 | ⬜ |
| 服务运行时 | 显示「停止」和「重启」按钮 | ⬜ |
| 服务停止时 | 仅显示「启动」按钮 | ⬜ |

---

## 五、配置版本控制

### 5.1 自动备份

| 测试用例 | 预期结果 | 状态 |
|----------|----------|------|
| 保存配置 | `.env_history/` 目录生成备份文件 | ⬜ |
| 备份命名 | 文件名包含时间戳 | ⬜ |
| 超过 5 个备份 | 自动删除最旧的备份（FIFO） | ⬜ |

---

### 5.2 历史版本管理

| 测试用例 | 预期结果 | 状态 |
|----------|----------|------|
| 点击「历史版本」按钮 | 弹出历史版本列表弹窗 | ⬜ |
| 选择某个版本 | 显示该版本与当前版本的 Diff 对比 | ⬜ |
| 点击「回滚」 | `.env` 恢复为选中版本，提示回滚成功 | ⬜ |
| 关闭弹窗后再次打开 | 弹窗能正常打开 | ⬜ |

---

## 六、运行时环境检测 (Runtime Diff)

| 测试用例 | 预期结果 | 状态 |
|----------|----------|------|
| 点击「运行环境检查」 | 弹出对比表格弹窗 | ⬜ |
| 本地与容器值一致 | 显示绿色 ✓ 或 Match 标识 | ⬜ |
| 本地已修改未重启 | 显示黄色警告，提示需重启 | ⬜ |
| 容器有本地没有 | 显示 Missing 标识 | ⬜ |
| 关闭弹窗后再次打开 | 弹窗能正常打开 | ⬜ |

---

## 七、实时日志

| 测试用例 | 预期结果 | 状态 |
|----------|----------|------|
| 点击「查看日志」按钮 | 弹出日志查看窗口 | ⬜ |
| 服务启动/重启时 | 实时推送容器日志 (SSE) | ⬜ |
| 默认「自动换行」开启 | 长日志正确换行 | ⬜ |
| 切换「自动换行」关闭 | 长日志不换行，可横向滚动 | ⬜ |
| 点击「清空日志」 | 日志区域清空 | ⬜ |
| 点击「关闭」 | 日志窗口关闭 | ⬜ |

---

## 八、弹窗交互

| 测试用例 | 预期结果 | 状态 |
|----------|----------|------|
| 确认弹窗点击「取消」 | 弹窗关闭，操作取消 | ⬜ |
| 取消后再次点击按钮 | 确认弹窗能再次正常弹出 | ⬜ |
| 历史弹窗关闭后再开 | 正常打开 | ⬜ |
| Diff 弹窗关闭后再开 | 正常打开 | ⬜ |
| 运行环境弹窗关闭后再开 | 正常打开 | ⬜ |
| 安装弹窗关闭后再开 | 正常打开 | ⬜ |

---

## 九、Edge 模式专项测试

| 测试模块 | 测试用例 | 预期结果 | 状态 |
|----------|----------|----------|------|
| Edge 连接配置 | 填写 CLOUD_ROUTING_KEY | 保存后写入 .env | ⬜ |
| Edge 连接配置 | 填写 CLOUD_ROUTING_SECRET | 保存后写入 .env | ⬜ |
| Edge 连接配置 | 填写 CLOUD_RPC_HOST | 保存后写入 .env | ⬜ |
| 云边通信状态检查 | 配置项可见且可编辑 | 正常 | ⬜ |
| 离线恢复策略 | 队列类型选 Kafka | 显示 3 个 Kafka 拉取条数配置 | ⬜ |
| 离线恢复策略 | 队列类型选 in-memory | Kafka 配置隐藏 | ⬜ |
| 遥测分离 | 启用遥测分离 | gRPC/Kafka 相关配置显示 | ⬜ |
| 遥测分离 | 禁用遥测分离 | 相关配置隐藏 | ⬜ |

---

## 十、Cloud 模式专项测试

| 测试模块 | 测试用例 | 预期结果 | 状态 |
|----------|----------|----------|------|
| 模式识别 | 加载 Cloud 模式 | 不显示 Edge 相关配置组 | ⬜ |
| MQTT 端口 | 配置 MQTT_BIND_PORT | 保存后写入 .env | ⬜ |
| 数据库配置 | PostgreSQL 连接配置 | 正常 | ⬜ |
| 缓存配置 | Redis/Caffeine 切换 | 正常 | ⬜ |
| 消息队列 | Kafka/in-memory 切换 | 正常 | ⬜ |

---

## 十一、测试结果汇总

| 模块 | 通过 | 失败 | 阻塞 | 备注 |
|------|------|------|------|------|
| 环境兼容性 | - | - | - | |
| 前置条件与初始化 | - | - | - | |
| 可视化配置管理 | - | - | - | |
| 容器生命周期管理 | - | - | - | |
| 配置版本控制 | - | - | - | |
| 运行时环境检测 | - | - | - | |
| 实时日志 | - | - | - | |
| 弹窗交互 | - | - | - | |
| Edge 模式专项 | - | - | - | |
| Cloud 模式专项 | - | - | - | |

---

## 附录：图例说明

| 符号 | 含义 |
|------|------|
| ⬜ | 待测试 |
| ✅ | 通过 |
| ❌ | 失败 |
| ⚠️ | 阻塞/跳过 |
